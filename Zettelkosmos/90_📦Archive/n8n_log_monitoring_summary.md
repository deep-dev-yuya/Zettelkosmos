---
title: n8nログ監視と自動削除の仕組み構築
tags: [n8n, ログ管理, 自動化, launchd, スクリプト]
created: 2025-06-27
type: project
---

# 🛠 n8nログ監視と自動削除の仕組み構築

## ✅ 概要
n8nの実行ログが肥大化しないように、**5分おきの監視スクリプト**と**毎日ログファイルを削除するスクリプト**を構築。過去の失敗を教訓に「不要なログを残さない仕組み」を意識して構成した。

---

## 🧩 目的と背景

- `n8n` をDockerでローカル常時稼働中。
- ログの蓄積によりストレージ圧迫や動作不安定が起きる可能性がある。
- 過去に「監視が過剰」でシステム過負荷になった経験がある。

---

## 🔁 構成内容

### 🔍 ログ監視スクリプト（5分おき）
- **パス**: `~/scripts/monitor_n8n_logs.sh`
- **起動方法**: `launchd`による5分おき実行（`StartInterval`）
- **目的**: `~/.n8n`ログのサイズや内容監視、異常検知のベース

### 🧹 ログ削除スクリプト（毎日1回）
- **パス**: `~/scripts/clean_n8n_logs.sh`
- **起動方法**: `launchd` による毎日自動実行
- **目的**: 前日までのログを削除して容量を制御

---

## 🔐 セキュリティと権限

- スクリプトに実行権限を付与：
  ```bash
  chmod +x ~/scripts/clean_n8n_logs.sh
  chmod +x ~/scripts/monitor_n8n_logs.sh
  ```

- `launchd` 設定ファイルは `~/Library/LaunchAgents` に配置し、
  `launchctl load ~/Library/LaunchAgents/com.user.monitor_n8n_logs.plist`  
  などでロード。

---

## ✅ 成功要因

- ✅ **チェックリスト**活用で過剰な監視を避けた  
- ✅ **過去の失敗**（監視しすぎ）から構成を改善  
- ✅ **AIの提案に対する批判的思考**で安全性と実用性を両立

---

## 🗂 今後の拡張案

- ログの削除条件をサイズベースやエラー内容にも対応させる
- 削除前に`backups/`フォルダに一時保管
- 通知機能（例: LINE通知）と連携することで異常時にアラート表示

---

{readable_date}

